<!DOCTYPE html>
<html lang="en-us" dir="ltr">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.5">
  <meta name="description" content="Behind every high-performing system lies a load balancer making invisible yet critical decisions—discover how these unsung heroes shape the digital world.">
<title>Building a Layer 7 Load Balancer | kbabuji</title>
    <link rel="stylesheet" href="/css/main.css">
      <script src="/js/main.js"></script><script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "\"Building a Layer 7 Load Balancer\"",
  "description": "\"Behind every high-performing system lies a load balancer making invisible yet critical decisions—discover how these unsung heroes shape the digital world.\"",
  "articleBody": "\"Load balancers are essential for applications or services that handle high volumes of traffic, ensuring that they can scale efficiently to meet demand. Modern load balancers have evolved into comprehensive traffic management solutions, often incorporating rate limiting, caching, DDoS protection, and more, making them indispensable for high-scale systems.\\nWhat is a load balancer? # Imagine you\\u0026rsquo;re at an airport, standing in line for the security check. There is a single line of passengers, but there are five booths with agents checking boarding passes and IDs. At the front of the line, there is an agent directing passengers to available booths. This agent acts like a basic load balancer, distributing incoming requests (passengers) to backend servers (TSA agents) for processing.\\nA load balancer does more than distribute requests. It also monitors the health of backend servers by periodically sending health checks or heartbeats to ensure they\\u0026rsquo;re functioning properly. Load balancers periodically run health checks so that requests do not get routed to unhealthy servers.\\nTypes of Load Balancers\\nThere are two common types of load balancers:\\nLayer 4 Load Balancer: Operates at the transport layer (TCP/UDP), distributing traffic based on IP addresses and ports. Layer 7 Load Balancer: Operates at the application layer (HTTP), distributing requests based on more granular details such as URL paths, headers, and even request content. Popular load balancers include AWS Elastic Load Balancer, NGINX, and HAProxy.\\nWhat is a layer 4 load balancer? # A Layer 4 load balancer operates at the transport layer (OSI Layer 4), distributing network traffic based on information from the TCP/UDP protocol. It does not inspect the application-level data, meaning it forwards packets to the backend servers without interpreting their content. Layer 4 load balancers make decisions based on the destination IP address and port.\\nBelow is a diagram of a simple load balancer. Requests (R1, R2, R3, R4) are distributed to three backend servers, and the forwarded requests are shown as FR1, FR2, FR3, and FR4.\\nDiagram of a load balancer Below is code for a simple load balancer that supports HTTP routes request in a Round Robin fashion.\\n1package main 2 3import ( 4\\t\\u0026#34;fmt\\u0026#34; 5\\t\\u0026#34;io\\u0026#34; 6\\t\\u0026#34;log\\u0026#34; 7\\t\\u0026#34;net/http\\u0026#34; 8\\t\\u0026#34;sync/atomic\\u0026#34; 9\\t\\u0026#34;time\\u0026#34; 10) 11 12type Backend struct { 13\\tURL string 14\\tAlive bool 15\\tHealth string 16} 17type LoadBalancer struct { 18\\tbackends []*Backend 19\\tcurrent uint32 20} 21 22func (lb *LoadBalancer) getNextBackend() *Backend { 23\\tnext := atomic.AddUint32(\\u0026amp;lb.current, 1) 24\\treturn lb.backends[next%uint32(len(lb.backends))] 25} 26// Periodically check all backends for health 27func (lb *LoadBalancer) healthCheck() { 28\\tfor _, backend := range lb.backends { 29\\tgo func(b *Backend) { 30\\tfor { 31\\tresp, err := http.Get(b.URL + b.Health) 32\\tif err != nil || resp.StatusCode != http.StatusOK { 33\\tb.Alive = false 34\\tlog.Printf(\\u0026#34;Backend %s is down\\\\n\\u0026#34;, b.URL) 35\\t} else { 36\\tb.Alive = true 37\\tlog.Printf(\\u0026#34;Backend %s is up\\\\n\\u0026#34;, b.URL) 38\\t} 39\\ttime.Sleep(10 * time.Second) 40\\t} 41\\t}(backend) 42\\t} 43} 44// Proxy forwards the request r to a backend and returns response w 45func (lb *LoadBalancer) proxy(w http.ResponseWriter, r *http.Request) { 46\\tbackend := lb.getNextBackend() 47 48 // Forward request to backend 49\\tresp, err := http.Get(backend.URL + r.URL.Path) 50\\tif err != nil || !backend.Alive { 51\\thttp.Error(w, \\u0026#34;Backend unavailable\\u0026#34;, http.StatusServiceUnavailable) 52\\treturn 53\\t} 54\\tdefer resp.Body.Close() 55 56 // Copies the response back to client 57\\tfor k, v := range resp.Header { 58\\tw.Header()[k] = v 59\\t} 60 61\\t_, err = io.Copy(w, resp.Body) 62\\tif err != nil { 63\\tlog.Printf(\\u0026#34;Error copying response from backend: %v\\u0026#34;, err) 64\\thttp.Error(w, \\u0026#34;Error forwarding response\\u0026#34;, http.StatusInternalServerError) 65\\t} 66} 67 68func main() { 69 // This can be any list of backends that you have 70\\tbackends := []*Backend{ 71\\t{URL: \\u0026#34;http://localhost:8081\\u0026#34;, Alive: true, Health: \\u0026#34;/health\\u0026#34;}, 72\\t{URL: \\u0026#34;http://localhost:8082\\u0026#34;, Alive: true, Health: \\u0026#34;/health\\u0026#34;}, 73\\t} 74 75\\tlb := \\u0026amp;LoadBalancer{backends: backends} 76 77\\tgo lb.healthCheck() 78\\thttp.HandleFunc(\\u0026#34;/\\u0026#34;, lb.proxy) 79\\tfmt.Println(\\u0026#34;Load Balancer started at :8080\\u0026#34;) 80\\tlog.Fatal(http.ListenAndServe(\\u0026#34;:8080\\u0026#34;, nil)) 81} You can refer to this article which I referred for inspiration when building a simple load balancer.\\nWhat is a layer 7 load balancer? # Layer 7 load balancers operate at the application layer (OSI Layer 7) and are more \\u0026ldquo;intelligent\\u0026rdquo; compared to Layer 4 load balancers. They can inspect request URLs, headers, and even body content, allowing them to make more sophisticated routing decisions based on application-level data.\\nKey Features of Layer 7 Load Balancers: # Routing based on URLs and parameters: They can route requests to specific backend servers based on the request path, query parameters, or headers. Sticky sessions: They can ensure that requests from the same user are consistently routed to the same server, which is useful for session persistence. Caching: They can cache responses, reducing the need to forward identical requests to the backend servers, which helps improve performance and reduce server load. While these features provide greater flexibility, they also come at the cost of increased complexity, maintenance, and performance overhead. However, for applications with sophisticated routing requirements, Layer 7 load balancers are often worth the trade-offs.\\nSSL Termination # Layer 7 load balancers can perform SSL termination, where encrypted SSL/TLS traffic is decrypted at the load balancer, and plain HTTP requests are forwarded to the backend servers. This offloads the computational burden of encryption from the backend servers and centralizes SSL certificate management.\\nHere’s how you can add SSL termination to your load balancer using Go:\\n1package main 2 3import ( 4\\t\\u0026#34;crypto/tls\\u0026#34; 5\\t\\u0026#34;fmt\\u0026#34; 6\\t\\u0026#34;log\\u0026#34; 7\\t\\u0026#34;net/http\\u0026#34; 8) 9 10func main() { 11\\t// Load the SSL certificate and key (You need to generate SSL certificates) 12\\tcertFile := \\u0026#34;cert.pem\\u0026#34; 13\\tkeyFile := \\u0026#34;key.pem\\u0026#34; 14 15\\t// Define your LoadBalancer handler 16\\tlb := \\u0026amp;LoadBalancer{} 17 18\\t// Create an HTTPS server with SSL termination 19\\tserver := \\u0026amp;http.Server{ 20\\tAddr: \\u0026#34;:8443\\u0026#34;, // or any other port 21\\tHandler: http.HandlerFunc(lb.proxy), 22\\tTLSConfig: \\u0026amp;tls.Config{ 23\\tMinVersion: tls.VersionTLS13, // or TLS12 if compatibility is needed 24\\t}, 25\\t} 26 27\\tfmt.Println(\\u0026#34;Load Balancer with SSL started at :8443\\u0026#34;) 28\\t// Start the HTTPS server with SSL 29\\tlog.Fatal(server.ListenAndServeTLS(certFile, keyFile)) 30} Key Steps for SSL Termination:\\nSSL Certificate: You’ll need to generate or obtain SSL certificates (cert.pem and key.pem). For development purposes, you can use self-signed certificates, but in production, you would obtain certificates from a trusted Certificate Authority (CA). TLS Configuration: The TLSConfig allows you to specify the minimum TLS version for security. TLS 1.3 is preferred for modern security standards. HTTPS Server: The ListenAndServeTLS method starts the HTTPS server, handling SSL/TLS connections. Routing requests # A Layer 7 load balancer can inspect request URLs and headers, allowing it to route traffic to specific backend services based on the request\\u0026rsquo;s path or parameters. This enables the load balancer to route traffic more intelligently. For example, API requests can be routed to different services (e.g., /apiA or /apiB) based on the URL path.\\nEach backend service typically registers its routes with the load balancer, specifying the paths or criteria that it can handle. The load balancer then forwards the appropriate requests to the right service.\\nExample: Minimal Request Router in Go\\nA Layer 7 load balancer can inspect request URLs and headers, allowing it to route traffic to specific backend services based on the request\\u0026rsquo;s path or parameters. This enables the load balancer to route traffic more intelligently. For example, API requests can be routed to different services (e.g., /apiA or /apiB) based on the URL path.\\nEach backend service typically registers its routes with the load balancer, specifying the paths or criteria that it can handle. The load balancer then forwards the appropriate requests to the right service. Example: Minimal Request Router in Go\\nHere\\u0026rsquo;s a minimal Go code example that demonstrates routing requests to different backend services using a simple path-based routing mechanism.\\n1package main 2 3import ( 4\\t\\u0026#34;fmt\\u0026#34; 5\\t\\u0026#34;log\\u0026#34; 6\\t\\u0026#34;net/http\\u0026#34; 7\\t\\u0026#34;strings\\u0026#34; 8) 9 10type Backend struct { 11\\tURL string 12} 13 14// RouteTable maps paths to specific backends 15type RouteTable map[string]*Backend 16 17type SimpleRouter struct { 18\\troutes RouteTable 19} 20 21// NewSimpleRouter initializes a router with predefined routes 22func NewSimpleRouter(routes RouteTable) *SimpleRouter { 23\\treturn \\u0026amp;SimpleRouter{routes: routes} 24} 25 26// ServeHTTP implements http.Handler and performs routing 27func (sr *SimpleRouter) ServeHTTP(w http.ResponseWriter, r *http.Request) { 28\\t// Extract the base path (e.g., /apiA, /apiB) 29\\tbasePath := strings.Split(r.URL.Path, \\u0026#34;/\\u0026#34;)[1] 30\\tbackend, exists := sr.routes[\\u0026#34;/\\u0026#34;+basePath] 31 32\\tif !exists { 33\\thttp.Error(w, \\u0026#34;Service not found\\u0026#34;, http.StatusNotFound) 34\\treturn 35\\t} 36 37\\t// Forward the request to the appropriate backend 38\\tresp, err := http.Get(backend.URL + r.URL.Path) 39\\tif err != nil { 40\\thttp.Error(w, \\u0026#34;Backend unavailable\\u0026#34;, http.StatusServiceUnavailable) 41\\treturn 42\\t} 43\\tdefer resp.Body.Close() 44 45\\t// Copy backend response back to client 46\\tfor k, v := range resp.Header { 47\\tw.Header()[k] = v 48\\t} 49\\t_, err = http.Copy(w, resp.Body) 50\\tif err != nil { 51\\thttp.Error(w, \\u0026#34;Error forwarding response\\u0026#34;, http.StatusInternalServerError) 52\\t} 53} 54 55func main() { 56\\t// Register routes to backend services 57\\troutes := RouteTable{ 58\\t\\u0026#34;/apiA\\u0026#34;: {URL: \\u0026#34;http://localhost:8081\\u0026#34;}, 59\\t\\u0026#34;/apiB\\u0026#34;: {URL: \\u0026#34;http://localhost:8082\\u0026#34;}, 60\\t} 61 62\\trouter := NewSimpleRouter(routes) 63 64\\t// Start the HTTP server with the router 65\\tfmt.Println(\\u0026#34;Load Balancer started at :8080\\u0026#34;) 66\\tlog.Fatal(http.ListenAndServe(\\u0026#34;:8080\\u0026#34;, router)) 67} Rate limiting # Rate limiting is an important feature that prevents backend servers from being overwhelmed by excessive requests during high traffic periods. Without rate limiting or similar protection, servers—or the entire service—could experience downtime or degraded performance.\\nThere are various algorithms used to implement rate limiting, each designed to control the flow of traffic in a different way. One common algorithm is the token bucket rate limiter, which allows a limited number of requests per time window. If the number of requests exceeds this limit, excess requests are denied. There are a couple of algorithms in performing rate limiting, you can refer this link to check it out.\\nExample: Token Bucket Rate Limiter in Go # Below is a minimal implementation of a token bucket rate limiter. The limiter controls the number of requests allowed in a given time window.\\n1package main 2 3import ( 4\\t\\u0026#34;log\\u0026#34; 5\\t\\u0026#34;net/http\\u0026#34; 6\\t\\u0026#34;sync\\u0026#34; 7\\t\\u0026#34;time\\u0026#34; 8) 9 10type RateLimiter struct { 11\\trequests int 12\\tlimit int 13\\twindow time.Duration 14\\tmu sync.Mutex 15\\tresetTimer *time.Ticker 16} 17 18func NewRateLimiter(limit int, window time.Duration) *RateLimiter { 19\\trl := \\u0026amp;RateLimiter{ 20\\trequests: 0, 21\\tlimit: limit, 22\\twindow: window, 23\\tresetTimer: time.NewTicker(window), 24\\t} 25\\tgo rl.reset() 26 27\\treturn rl 28} 29 30func (rl *RateLimiter) Allow() bool { 31\\trl.mu.Lock() 32\\tdefer rl.mu.Unlock() 33 34\\tif rl.requests \\u0026gt;= rl.limit { 35\\treturn false 36\\t} 37\\trl.requests++ 38\\treturn true 39} 40 41func (rl *RateLimiter) reset() { 42\\tfor range rl.resetTimer.C { 43\\trl.mu.Lock() 44\\trl.requests = 0 45\\trl.mu.Unlock() 46\\t} 47} 48 49func (rl *RateLimiter) Middleware(next http.Handler) http.Handler { 50\\treturn http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { 51\\tif !rl.Allow() { 52\\tlog.Printf(\\u0026#34;Rate limit exceeded for %s\\u0026#34;, r.URL.Path) 53\\thttp.Error(w, \\u0026#34;Rate limit exceeded\\u0026#34;, http.StatusTooManyRequests) 54\\treturn 55\\t} 56\\tnext.ServeHTTP(w, r) 57\\t}) 58} 59 60func main() { 61\\tlimiter := NewRateLimiter(10, time.Minute) 62 63\\thttp.Handle(\\u0026#34;/\\u0026#34;, limiter.Middleware(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { 64\\tw.Write([]byte(\\u0026#34;Request successful!\\u0026#34;)) 65\\t}))) 66 67\\tlog.Println(\\u0026#34;Server started on :8080\\u0026#34;) 68\\tlog.Fatal(http.ListenAndServe(\\u0026#34;:8080\\u0026#34;, nil)) 69} The above rate limiter is now based on a global request counter rather than IP-based tracking, making it simpler for demonstration purposes.\\nFuture improvements # For future improvements, I plan to:\\nSet up a circuit breaker – To prevent overwhelming backends that are failing or underperforming by temporarily stopping requests to them. Explore different routing strategies, like weighted round robin or least connections, to optimize request distribution based on backend capacity. Dynamically update the backend servers list – Automatically remove any failing servers from the list and add new ones without downtime. Implement session persistence, ensuring that users consistently connect to the same backend during their session. Cache requests to reduce load on backends and improve response times for repeated requests. See the github repository.\\n\"",
  "image": ["\"http://localhost:1313/load_balancer.webp\""],
  "datePublished": "2024-09-15T15:05:28-06:00",
  "dateModified": "2024-09-15T15:05:28-06:00",
  "url": "\"http://localhost:1313/articles/building-a-layer7-load-balancer/\"",
  "mainEntityOfPage": "\"http://localhost:1313/articles/building-a-layer7-load-balancer/\"",
  "author": {
    "@type": "Person",
    "name": "\"Krishna Babuji\"",
    "url": "\"http://localhost:1313/about\"",
    "image": "\"http://localhost:1313/about/images/portrait.webp\""
  },
  "publisher": {
    "@type": "Organization",
    "name": "\"kbabuji\"",
    "logo": {
      "@type": "ImageObject",
      "url": "\"http://localhost:1313/favicon-32x32.png\""
    }
  },
  "articleSection": "\"sda\"",
  "keywords": "[\"golang\",\"load balancer\"]",
  "wordCount":  2005 
}
</script>
<meta property="og:url" content="http://localhost:1313/articles/building-a-layer7-load-balancer/">
  <meta property="og:site_name" content="kbabuji">
  <meta property="og:title" content="Building a Layer 7 Load Balancer">
  <meta property="og:description" content="Behind every high-performing system lies a load balancer making invisible yet critical decisions—discover how these unsung heroes shape the digital world.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2024-09-15T15:05:28-06:00">
    <meta property="article:modified_time" content="2024-09-15T15:05:28-06:00">
    <meta property="article:tag" content="Golang">
    <meta property="article:tag" content="Load Balancer">
    <meta property="og:image" content="http://localhost:1313/articles/building-a-layer7-load-balancer/load_balancer.webp">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>

<body>
  <header class="navbar">
    <div class="masthead">
    <h2><a class="site-title" href="/">kbabuji</a></h2>
    <nav class="nav-links">
        <a href="/about" aria-label="About me">About</a>
        <a href="/articles">Archives</a>
        <a href="/categories">Categories</a>
        <a href="/tags">Tags</a>
    </nav>
</div>
  </header>
  <main class="wrapper">
    
<article class="article-container">
    
    <header class="article-header">
        <div class="category">System Design &amp; Architecture</div>
        <h1 class="title">Building a Layer 7 Load Balancer</h1>
        <p class="description">Behind every high-performing system lies a load balancer making invisible yet critical decisions—discover how these unsung heroes shape the digital world.</p>
        <div class="meta">
            <time datetime="2024-09-15">
                September 15, 2024
            </time>
        </div>
    </header>
    <div class="minimal-divider"></div>

    
    <div class="content">
        <p>Load balancers are essential for applications or services that handle high volumes of traffic, ensuring that they can scale efficiently to meet demand. Modern load balancers have evolved into comprehensive traffic management solutions, often incorporating rate limiting, caching, DDoS protection, and more, making them indispensable for high-scale systems.</p>
<h2 id="what-is-a-load-balancer">
  What is a load balancer?
  <a class="anchor" href="#what-is-a-load-balancer" aria-label="Link to section - What is a load balancer?">#</a>
</h2>

<p>Imagine you&rsquo;re at an airport, standing in line for the security check. There is a single line of passengers, but there are five booths with agents checking boarding passes and IDs. At the front of the line, there is an agent directing passengers to available booths. This agent acts like a basic load balancer, distributing incoming requests (passengers) to backend servers (TSA agents) for processing.</p>
<p>A load balancer does more than distribute requests. It also monitors the health of backend servers by periodically sending health checks or heartbeats to ensure they&rsquo;re functioning properly. Load balancers periodically run health checks so that requests do not get routed to unhealthy servers.</p>
<p>Types of Load Balancers</p>
<p>There are two common types of load balancers:</p>
<ol>
<li><strong>Layer 4 Load Balancer</strong>: Operates at the transport layer (TCP/UDP), distributing traffic based on IP addresses and ports.</li>
<li><strong>Layer 7 Load Balancer</strong>: Operates at the application layer (HTTP), distributing requests based on more granular details such as URL paths, headers, and even request content.</li>
</ol>
<p>Popular load balancers include AWS <a href="https://aws.amazon.com/elasticloadbalancing/">Elastic Load Balancer</a>, <a href="https://www.f5.com/go/product/welcome-to-nginx">NGINX</a>, and <a href="https://www.haproxy.org/">HAProxy</a>.</p>
<hr>
<h2 id="what-is-a-layer-4-load-balancer">
  What is a layer 4 load balancer?
  <a class="anchor" href="#what-is-a-layer-4-load-balancer" aria-label="Link to section - What is a layer 4 load balancer?">#</a>
</h2>

<p>A Layer 4 load balancer operates at the transport layer (OSI Layer 4), distributing network traffic based on information from the TCP/UDP protocol. It does not inspect the application-level data, meaning it forwards packets to the backend servers without interpreting their content. Layer 4 load balancers make decisions based on the destination IP address and port.</p>
<p>Below is a diagram of a simple load balancer. Requests (R1, R2, R3, R4) are distributed to three backend servers, and the forwarded requests are shown as FR1, FR2, FR3, and FR4.</p>
<figure><img src="/articles/building-a-layer7-load-balancer/load_balancer.webp"
    alt="Diagram of a load balancer showing incoming requests to the layer 4 LB and forwarded requests to the replicated servers" loading="lazy"><figcaption>
      <h4>Diagram of a load balancer</h4>
    </figcaption>
</figure>

<p>Below is code for a simple load balancer that supports HTTP routes request in a Round Robin fashion.</p>
<div class="highlight" id="minimal-l4"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 1</span><span><span style="color:#8bd5ca">package</span> main
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 3</span><span><span style="color:#8bd5ca">import</span> (
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 4</span><span>	<span style="color:#a6da95">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 5</span><span>	<span style="color:#a6da95">&#34;io&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 6</span><span>	<span style="color:#a6da95">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 7</span><span>	<span style="color:#a6da95">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 8</span><span>	<span style="color:#a6da95">&#34;sync/atomic&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 9</span><span>	<span style="color:#a6da95">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">10</span><span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">11</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">12</span><span><span style="color:#ed8796">type</span> Backend <span style="color:#ed8796">struct</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">13</span><span>	URL    <span style="color:#ed8796">string</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">14</span><span>	Alive  <span style="color:#ed8796">bool</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">15</span><span>	Health <span style="color:#ed8796">string</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">16</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">17</span><span><span style="color:#ed8796">type</span> LoadBalancer <span style="color:#ed8796">struct</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">18</span><span>	backends []<span style="color:#91d7e3;font-weight:bold">*</span>Backend
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">19</span><span>	current  <span style="color:#ed8796">uint32</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">20</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">21</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">22</span><span><span style="color:#ed8796">func</span> (lb <span style="color:#91d7e3;font-weight:bold">*</span>LoadBalancer) <span style="color:#8aadf4">getNextBackend</span>() <span style="color:#91d7e3;font-weight:bold">*</span>Backend {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">23</span><span>	next <span style="color:#91d7e3;font-weight:bold">:=</span> atomic.<span style="color:#8aadf4">AddUint32</span>(<span style="color:#91d7e3;font-weight:bold">&amp;</span>lb.current, <span style="color:#f5a97f">1</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">24</span><span>	<span style="color:#c6a0f6">return</span> lb.backends[next<span style="color:#91d7e3;font-weight:bold">%</span><span style="color:#91d7e3">uint32</span>(<span style="color:#91d7e3">len</span>(lb.backends))]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">25</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">26</span><span><span style="color:#6e738d;font-style:italic">// Periodically check all backends for health</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">27</span><span><span style="color:#ed8796">func</span> (lb <span style="color:#91d7e3;font-weight:bold">*</span>LoadBalancer) <span style="color:#8aadf4">healthCheck</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">28</span><span>	<span style="color:#c6a0f6">for</span> _, backend <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#c6a0f6">range</span> lb.backends {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">29</span><span>		<span style="color:#c6a0f6">go</span> <span style="color:#ed8796">func</span>(b <span style="color:#91d7e3;font-weight:bold">*</span>Backend) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">30</span><span>			<span style="color:#c6a0f6">for</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">31</span><span>				resp, err <span style="color:#91d7e3;font-weight:bold">:=</span> http.<span style="color:#8aadf4">Get</span>(b.URL <span style="color:#91d7e3;font-weight:bold">+</span> b.Health)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">32</span><span>				<span style="color:#c6a0f6">if</span> err <span style="color:#91d7e3;font-weight:bold">!=</span> <span style="color:#f5a97f">nil</span> <span style="color:#91d7e3;font-weight:bold">||</span> resp.StatusCode <span style="color:#91d7e3;font-weight:bold">!=</span> http.StatusOK {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">33</span><span>					b.Alive = <span style="color:#f5a97f">false</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">34</span><span>					log.<span style="color:#8aadf4">Printf</span>(<span style="color:#a6da95">&#34;Backend %s is down\n&#34;</span>, b.URL)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">35</span><span>				} <span style="color:#c6a0f6">else</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">36</span><span>					b.Alive = <span style="color:#f5a97f">true</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">37</span><span>					log.<span style="color:#8aadf4">Printf</span>(<span style="color:#a6da95">&#34;Backend %s is up\n&#34;</span>, b.URL)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">38</span><span>				}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">39</span><span>				time.<span style="color:#8aadf4">Sleep</span>(<span style="color:#f5a97f">10</span> <span style="color:#91d7e3;font-weight:bold">*</span> time.Second)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">40</span><span>			}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">41</span><span>		}(backend)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">42</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">43</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">44</span><span><span style="color:#6e738d;font-style:italic">// Proxy forwards the request r to a backend and returns response w</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">45</span><span><span style="color:#ed8796">func</span> (lb <span style="color:#91d7e3;font-weight:bold">*</span>LoadBalancer) <span style="color:#8aadf4">proxy</span>(w http.ResponseWriter, r <span style="color:#91d7e3;font-weight:bold">*</span>http.Request) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">46</span><span>	backend <span style="color:#91d7e3;font-weight:bold">:=</span> lb.<span style="color:#8aadf4">getNextBackend</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">47</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">48</span><span>    <span style="color:#6e738d;font-style:italic">// Forward request to backend</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">49</span><span>	resp, err <span style="color:#91d7e3;font-weight:bold">:=</span> http.<span style="color:#8aadf4">Get</span>(backend.URL <span style="color:#91d7e3;font-weight:bold">+</span> r.URL.Path)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">50</span><span>	<span style="color:#c6a0f6">if</span> err <span style="color:#91d7e3;font-weight:bold">!=</span> <span style="color:#f5a97f">nil</span> <span style="color:#91d7e3;font-weight:bold">||</span> !backend.Alive {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">51</span><span>		http.<span style="color:#8aadf4">Error</span>(w, <span style="color:#a6da95">&#34;Backend unavailable&#34;</span>, http.StatusServiceUnavailable)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">52</span><span>		<span style="color:#c6a0f6">return</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">53</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">54</span><span>	<span style="color:#c6a0f6">defer</span> resp.Body.<span style="color:#8aadf4">Close</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">55</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">56</span><span>    <span style="color:#6e738d;font-style:italic">// Copies the response back to client</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">57</span><span>	<span style="color:#c6a0f6">for</span> k, v <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#c6a0f6">range</span> resp.Header {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">58</span><span>		w.<span style="color:#8aadf4">Header</span>()[k] = v
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">59</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">60</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">61</span><span>	_, err = io.<span style="color:#8aadf4">Copy</span>(w, resp.Body)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">62</span><span>	<span style="color:#c6a0f6">if</span> err <span style="color:#91d7e3;font-weight:bold">!=</span> <span style="color:#f5a97f">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">63</span><span>		log.<span style="color:#8aadf4">Printf</span>(<span style="color:#a6da95">&#34;Error copying response from backend: %v&#34;</span>, err)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">64</span><span>		http.<span style="color:#8aadf4">Error</span>(w, <span style="color:#a6da95">&#34;Error forwarding response&#34;</span>, http.StatusInternalServerError)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">65</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">66</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">67</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">68</span><span><span style="color:#ed8796">func</span> <span style="color:#8aadf4">main</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">69</span><span>    <span style="color:#6e738d;font-style:italic">// This can be any list of backends that you have</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">70</span><span>	backends <span style="color:#91d7e3;font-weight:bold">:=</span> []<span style="color:#91d7e3;font-weight:bold">*</span>Backend{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">71</span><span>		{URL: <span style="color:#a6da95">&#34;http://localhost:8081&#34;</span>, Alive: <span style="color:#f5a97f">true</span>, Health: <span style="color:#a6da95">&#34;/health&#34;</span>},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">72</span><span>		{URL: <span style="color:#a6da95">&#34;http://localhost:8082&#34;</span>, Alive: <span style="color:#f5a97f">true</span>, Health: <span style="color:#a6da95">&#34;/health&#34;</span>},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">73</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">74</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">75</span><span>	lb <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#91d7e3;font-weight:bold">&amp;</span>LoadBalancer{backends: backends}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">76</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">77</span><span>	<span style="color:#c6a0f6">go</span> lb.<span style="color:#8aadf4">healthCheck</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">78</span><span>	http.<span style="color:#8aadf4">HandleFunc</span>(<span style="color:#a6da95">&#34;/&#34;</span>, lb.proxy)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">79</span><span>	fmt.<span style="color:#8aadf4">Println</span>(<span style="color:#a6da95">&#34;Load Balancer started at :8080&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">80</span><span>	log.<span style="color:#8aadf4">Fatal</span>(http.<span style="color:#8aadf4">ListenAndServe</span>(<span style="color:#a6da95">&#34;:8080&#34;</span>, <span style="color:#f5a97f">nil</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">81</span><span>}
</span></span></code></pre></div><p>You can refer to this <a href="https://kasvith.me/posts/lets-create-a-simple-lb-go/">article</a> which I referred for inspiration when building a simple load balancer.</p>
<hr>
<h2 id="what-is-a-layer-7-load-balancer">
  What is a layer 7 load balancer?
  <a class="anchor" href="#what-is-a-layer-7-load-balancer" aria-label="Link to section - What is a layer 7 load balancer?">#</a>
</h2>

<p>Layer 7 load balancers operate at the application layer (OSI Layer 7) and are more &ldquo;intelligent&rdquo; compared to Layer 4 load balancers. They can inspect request URLs, headers, and even body content, allowing them to make more sophisticated routing decisions based on application-level data.</p>
<h3 id="key-features-of-layer-7-load-balancers">
  Key Features of Layer 7 Load Balancers:
  <a class="anchor" href="#key-features-of-layer-7-load-balancers" aria-label="Link to section - Key Features of Layer 7 Load Balancers:">#</a>
</h3>

<ul>
<li><strong>Routing based on URLs and parameters</strong>: They can route requests to specific backend servers based on the request path, query parameters, or headers.</li>
<li><strong>Sticky sessions</strong>: They can ensure that requests from the same user are consistently routed to the same server, which is useful for session persistence.</li>
<li><strong>Caching</strong>: They can cache responses, reducing the need to forward identical requests to the backend servers, which helps improve performance and reduce server load.</li>
</ul>
<p>While these features provide greater flexibility, they also come at the cost of increased complexity, maintenance, and performance overhead. However, for applications with sophisticated routing requirements, Layer 7 load balancers are often worth the trade-offs.</p>
<h2 id="ssl-termination">
  SSL Termination
  <a class="anchor" href="#ssl-termination" aria-label="Link to section - SSL Termination">#</a>
</h2>

<p>Layer 7 load balancers can perform SSL termination, where encrypted SSL/TLS traffic is decrypted at the load balancer, and plain HTTP requests are forwarded to the backend servers. This offloads the computational burden of encryption from the backend servers and centralizes SSL certificate management.</p>
<p>Here’s how you can add SSL termination to your load balancer using Go:</p>
<div class="highlight" id="minimal-SSL-termination"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 1</span><span><span style="color:#8bd5ca">package</span> main
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 3</span><span><span style="color:#8bd5ca">import</span> (
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 4</span><span>	<span style="color:#a6da95">&#34;crypto/tls&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 5</span><span>	<span style="color:#a6da95">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 6</span><span>	<span style="color:#a6da95">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 7</span><span>	<span style="color:#a6da95">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 8</span><span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">10</span><span><span style="color:#ed8796">func</span> <span style="color:#8aadf4">main</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">11</span><span>	<span style="color:#6e738d;font-style:italic">// Load the SSL certificate and key (You need to generate SSL certificates)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">12</span><span>	certFile <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#a6da95">&#34;cert.pem&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">13</span><span>	keyFile <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#a6da95">&#34;key.pem&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">15</span><span>	<span style="color:#6e738d;font-style:italic">// Define your LoadBalancer handler</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">16</span><span>	lb <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#91d7e3;font-weight:bold">&amp;</span>LoadBalancer{}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">18</span><span>	<span style="color:#6e738d;font-style:italic">// Create an HTTPS server with SSL termination</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">19</span><span>	server <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#91d7e3;font-weight:bold">&amp;</span>http.Server{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">20</span><span>		Addr:    <span style="color:#a6da95">&#34;:8443&#34;</span>, <span style="color:#6e738d;font-style:italic">// or any other port</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">21</span><span>		Handler: http.<span style="color:#8aadf4">HandlerFunc</span>(lb.proxy),
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">22</span><span>		TLSConfig: <span style="color:#91d7e3;font-weight:bold">&amp;</span>tls.Config{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">23</span><span>			MinVersion: tls.VersionTLS13, <span style="color:#6e738d;font-style:italic">// or TLS12 if compatibility is needed</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">24</span><span>		},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">25</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">26</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">27</span><span>	fmt.<span style="color:#8aadf4">Println</span>(<span style="color:#a6da95">&#34;Load Balancer with SSL started at :8443&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">28</span><span>	<span style="color:#6e738d;font-style:italic">// Start the HTTPS server with SSL</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">29</span><span>	log.<span style="color:#8aadf4">Fatal</span>(server.<span style="color:#8aadf4">ListenAndServeTLS</span>(certFile, keyFile))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">30</span><span>}
</span></span></code></pre></div><p>Key Steps for SSL Termination:</p>
<ul>
<li><strong>SSL Certificate</strong>: You’ll need to generate or obtain SSL certificates (cert.pem and key.pem). For development purposes, you can use self-signed certificates, but in production, you would obtain certificates from a trusted Certificate Authority (CA).</li>
<li><strong>TLS Configuration</strong>: The TLSConfig allows you to specify the minimum TLS version for security. TLS 1.3 is preferred for modern security standards.</li>
<li><strong>HTTPS Server</strong>: The ListenAndServeTLS method starts the HTTPS server, handling SSL/TLS connections.</li>
</ul>
<h2 id="routing-requests">
  Routing requests
  <a class="anchor" href="#routing-requests" aria-label="Link to section - Routing requests">#</a>
</h2>

<p>A Layer 7 load balancer can inspect request URLs and headers, allowing it to route traffic to specific backend services based on the request&rsquo;s path or parameters. This enables the load balancer to route traffic more intelligently. For example, API requests can be routed to different services (e.g., /apiA or /apiB) based on the URL path.</p>
<p>Each backend service typically registers its routes with the load balancer, specifying the paths or criteria that it can handle. The load balancer then forwards the appropriate requests to the right service.</p>
<p><strong>Example: Minimal Request Router in Go</strong></p>
<p>A Layer 7 load balancer can inspect request URLs and headers, allowing it to route traffic to specific backend services based on the request&rsquo;s path or parameters. This enables the load balancer to route traffic more intelligently. For example, API requests can be routed to different services (e.g., /apiA or /apiB) based on the URL path.</p>
<p>Each backend service typically registers its routes with the load balancer, specifying the paths or criteria that it can handle. The load balancer then forwards the appropriate requests to the right service.
Example: Minimal Request Router in Go</p>
<p>Here&rsquo;s a minimal Go code example that demonstrates routing requests to different backend services using a simple path-based routing mechanism.</p>
<div class="highlight" id="minimal-l7"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 1</span><span><span style="color:#8bd5ca">package</span> main
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 3</span><span><span style="color:#8bd5ca">import</span> (
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 4</span><span>	<span style="color:#a6da95">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 5</span><span>	<span style="color:#a6da95">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 6</span><span>	<span style="color:#a6da95">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 7</span><span>	<span style="color:#a6da95">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 8</span><span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">10</span><span><span style="color:#ed8796">type</span> Backend <span style="color:#ed8796">struct</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">11</span><span>	URL <span style="color:#ed8796">string</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">12</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">13</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">14</span><span><span style="color:#6e738d;font-style:italic">// RouteTable maps paths to specific backends</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">15</span><span><span style="color:#ed8796">type</span> RouteTable <span style="color:#ed8796">map</span>[<span style="color:#ed8796">string</span>]<span style="color:#91d7e3;font-weight:bold">*</span>Backend
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">17</span><span><span style="color:#ed8796">type</span> SimpleRouter <span style="color:#ed8796">struct</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">18</span><span>	routes RouteTable
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">19</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">20</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">21</span><span><span style="color:#6e738d;font-style:italic">// NewSimpleRouter initializes a router with predefined routes</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">22</span><span><span style="color:#ed8796">func</span> <span style="color:#8aadf4">NewSimpleRouter</span>(routes RouteTable) <span style="color:#91d7e3;font-weight:bold">*</span>SimpleRouter {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">23</span><span>	<span style="color:#c6a0f6">return</span> <span style="color:#91d7e3;font-weight:bold">&amp;</span>SimpleRouter{routes: routes}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">24</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">25</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">26</span><span><span style="color:#6e738d;font-style:italic">// ServeHTTP implements http.Handler and performs routing</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">27</span><span><span style="color:#ed8796">func</span> (sr <span style="color:#91d7e3;font-weight:bold">*</span>SimpleRouter) <span style="color:#8aadf4">ServeHTTP</span>(w http.ResponseWriter, r <span style="color:#91d7e3;font-weight:bold">*</span>http.Request) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">28</span><span>	<span style="color:#6e738d;font-style:italic">// Extract the base path (e.g., /apiA, /apiB)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">29</span><span>	basePath <span style="color:#91d7e3;font-weight:bold">:=</span> strings.<span style="color:#8aadf4">Split</span>(r.URL.Path, <span style="color:#a6da95">&#34;/&#34;</span>)[<span style="color:#f5a97f">1</span>]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">30</span><span>	backend, exists <span style="color:#91d7e3;font-weight:bold">:=</span> sr.routes[<span style="color:#a6da95">&#34;/&#34;</span><span style="color:#91d7e3;font-weight:bold">+</span>basePath]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">31</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">32</span><span>	<span style="color:#c6a0f6">if</span> !exists {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">33</span><span>		http.<span style="color:#8aadf4">Error</span>(w, <span style="color:#a6da95">&#34;Service not found&#34;</span>, http.StatusNotFound)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">34</span><span>		<span style="color:#c6a0f6">return</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">35</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">36</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">37</span><span>	<span style="color:#6e738d;font-style:italic">// Forward the request to the appropriate backend</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">38</span><span>	resp, err <span style="color:#91d7e3;font-weight:bold">:=</span> http.<span style="color:#8aadf4">Get</span>(backend.URL <span style="color:#91d7e3;font-weight:bold">+</span> r.URL.Path)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">39</span><span>	<span style="color:#c6a0f6">if</span> err <span style="color:#91d7e3;font-weight:bold">!=</span> <span style="color:#f5a97f">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">40</span><span>		http.<span style="color:#8aadf4">Error</span>(w, <span style="color:#a6da95">&#34;Backend unavailable&#34;</span>, http.StatusServiceUnavailable)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">41</span><span>		<span style="color:#c6a0f6">return</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">42</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">43</span><span>	<span style="color:#c6a0f6">defer</span> resp.Body.<span style="color:#8aadf4">Close</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">44</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">45</span><span>	<span style="color:#6e738d;font-style:italic">// Copy backend response back to client</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">46</span><span>	<span style="color:#c6a0f6">for</span> k, v <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#c6a0f6">range</span> resp.Header {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">47</span><span>		w.<span style="color:#8aadf4">Header</span>()[k] = v
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">48</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">49</span><span>	_, err = http.<span style="color:#8aadf4">Copy</span>(w, resp.Body)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">50</span><span>	<span style="color:#c6a0f6">if</span> err <span style="color:#91d7e3;font-weight:bold">!=</span> <span style="color:#f5a97f">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">51</span><span>		http.<span style="color:#8aadf4">Error</span>(w, <span style="color:#a6da95">&#34;Error forwarding response&#34;</span>, http.StatusInternalServerError)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">52</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">53</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">54</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">55</span><span><span style="color:#ed8796">func</span> <span style="color:#8aadf4">main</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">56</span><span>	<span style="color:#6e738d;font-style:italic">// Register routes to backend services</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">57</span><span>	routes <span style="color:#91d7e3;font-weight:bold">:=</span> RouteTable{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">58</span><span>		<span style="color:#a6da95">&#34;/apiA&#34;</span>: {URL: <span style="color:#a6da95">&#34;http://localhost:8081&#34;</span>},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">59</span><span>		<span style="color:#a6da95">&#34;/apiB&#34;</span>: {URL: <span style="color:#a6da95">&#34;http://localhost:8082&#34;</span>},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">60</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">61</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">62</span><span>	router <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#8aadf4">NewSimpleRouter</span>(routes)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">63</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">64</span><span>	<span style="color:#6e738d;font-style:italic">// Start the HTTP server with the router</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">65</span><span>	fmt.<span style="color:#8aadf4">Println</span>(<span style="color:#a6da95">&#34;Load Balancer started at :8080&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">66</span><span>	log.<span style="color:#8aadf4">Fatal</span>(http.<span style="color:#8aadf4">ListenAndServe</span>(<span style="color:#a6da95">&#34;:8080&#34;</span>, router))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">67</span><span>}
</span></span></code></pre></div><hr>
<h2 id="rate-limiting">
  Rate limiting
  <a class="anchor" href="#rate-limiting" aria-label="Link to section - Rate limiting">#</a>
</h2>

<p>Rate limiting is an important feature that prevents backend servers from being overwhelmed by excessive requests during high traffic periods. Without rate limiting or similar protection, servers—or the entire service—could experience downtime or degraded performance.</p>
<p>There are various algorithms used to implement rate limiting, each designed to control the flow of traffic in a different way. One common algorithm is the token bucket rate limiter, which allows a limited number of requests per time window. If the number of requests exceeds this limit, excess requests are denied. There are a couple of algorithms in performing rate limiting, you can refer this <a href="https://blog.logrocket.com/advanced-guide-rate-limiting-api-traffic-management/">link</a> to check it out.</p>
<h3 id="example-token-bucket-rate-limiter-in-go">
  Example: Token Bucket Rate Limiter in Go
  <a class="anchor" href="#example-token-bucket-rate-limiter-in-go" aria-label="Link to section - Example: Token Bucket Rate Limiter in Go">#</a>
</h3>

<p>Below is a minimal implementation of a token bucket rate limiter. The limiter controls the number of requests allowed in a given time window.</p>
<div class="highlight" id="token-bucket"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 1</span><span><span style="color:#8bd5ca">package</span> main
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 3</span><span><span style="color:#8bd5ca">import</span> (
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 4</span><span>	<span style="color:#a6da95">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 5</span><span>	<span style="color:#a6da95">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 6</span><span>	<span style="color:#a6da95">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 7</span><span>	<span style="color:#a6da95">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 8</span><span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">10</span><span><span style="color:#ed8796">type</span> RateLimiter <span style="color:#ed8796">struct</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">11</span><span>	requests   <span style="color:#ed8796">int</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">12</span><span>	limit      <span style="color:#ed8796">int</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">13</span><span>	window     time.Duration
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">14</span><span>	mu         sync.Mutex
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">15</span><span>	resetTimer <span style="color:#91d7e3;font-weight:bold">*</span>time.Ticker
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">16</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">18</span><span><span style="color:#ed8796">func</span> <span style="color:#8aadf4">NewRateLimiter</span>(limit <span style="color:#ed8796">int</span>, window time.Duration) <span style="color:#91d7e3;font-weight:bold">*</span>RateLimiter {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">19</span><span>	rl <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#91d7e3;font-weight:bold">&amp;</span>RateLimiter{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">20</span><span>		requests:   <span style="color:#f5a97f">0</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">21</span><span>		limit:      limit,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">22</span><span>		window:     window,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">23</span><span>		resetTimer: time.<span style="color:#8aadf4">NewTicker</span>(window),
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">24</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">25</span><span>	<span style="color:#c6a0f6">go</span> rl.<span style="color:#8aadf4">reset</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">26</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">27</span><span>	<span style="color:#c6a0f6">return</span> rl
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">28</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">29</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">30</span><span><span style="color:#ed8796">func</span> (rl <span style="color:#91d7e3;font-weight:bold">*</span>RateLimiter) <span style="color:#8aadf4">Allow</span>() <span style="color:#ed8796">bool</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">31</span><span>	rl.mu.<span style="color:#8aadf4">Lock</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">32</span><span>	<span style="color:#c6a0f6">defer</span> rl.mu.<span style="color:#8aadf4">Unlock</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">33</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">34</span><span>	<span style="color:#c6a0f6">if</span> rl.requests <span style="color:#91d7e3;font-weight:bold">&gt;=</span> rl.limit {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">35</span><span>		<span style="color:#c6a0f6">return</span> <span style="color:#f5a97f">false</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">36</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">37</span><span>	rl.requests<span style="color:#91d7e3;font-weight:bold">++</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">38</span><span>	<span style="color:#c6a0f6">return</span> <span style="color:#f5a97f">true</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">39</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">40</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">41</span><span><span style="color:#ed8796">func</span> (rl <span style="color:#91d7e3;font-weight:bold">*</span>RateLimiter) <span style="color:#8aadf4">reset</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">42</span><span>	<span style="color:#c6a0f6">for</span> <span style="color:#c6a0f6">range</span> rl.resetTimer.C {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">43</span><span>		rl.mu.<span style="color:#8aadf4">Lock</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">44</span><span>		rl.requests = <span style="color:#f5a97f">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">45</span><span>		rl.mu.<span style="color:#8aadf4">Unlock</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">46</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">47</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">48</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">49</span><span><span style="color:#ed8796">func</span> (rl <span style="color:#91d7e3;font-weight:bold">*</span>RateLimiter) <span style="color:#8aadf4">Middleware</span>(next http.Handler) http.Handler {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">50</span><span>	<span style="color:#c6a0f6">return</span> http.<span style="color:#8aadf4">HandlerFunc</span>(<span style="color:#ed8796">func</span>(w http.ResponseWriter, r <span style="color:#91d7e3;font-weight:bold">*</span>http.Request) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">51</span><span>		<span style="color:#c6a0f6">if</span> !rl.<span style="color:#8aadf4">Allow</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">52</span><span>			log.<span style="color:#8aadf4">Printf</span>(<span style="color:#a6da95">&#34;Rate limit exceeded for %s&#34;</span>, r.URL.Path)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">53</span><span>			http.<span style="color:#8aadf4">Error</span>(w, <span style="color:#a6da95">&#34;Rate limit exceeded&#34;</span>, http.StatusTooManyRequests)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">54</span><span>			<span style="color:#c6a0f6">return</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">55</span><span>		}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">56</span><span>		next.<span style="color:#8aadf4">ServeHTTP</span>(w, r)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">57</span><span>	})
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">58</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">59</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">60</span><span><span style="color:#ed8796">func</span> <span style="color:#8aadf4">main</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">61</span><span>	limiter <span style="color:#91d7e3;font-weight:bold">:=</span> <span style="color:#8aadf4">NewRateLimiter</span>(<span style="color:#f5a97f">10</span>, time.Minute)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">62</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">63</span><span>	http.<span style="color:#8aadf4">Handle</span>(<span style="color:#a6da95">&#34;/&#34;</span>, limiter.<span style="color:#8aadf4">Middleware</span>(http.<span style="color:#8aadf4">HandlerFunc</span>(<span style="color:#ed8796">func</span>(w http.ResponseWriter, r <span style="color:#91d7e3;font-weight:bold">*</span>http.Request) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">64</span><span>		w.<span style="color:#8aadf4">Write</span>([]<span style="color:#91d7e3">byte</span>(<span style="color:#a6da95">&#34;Request successful!&#34;</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">65</span><span>	})))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">66</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">67</span><span>	log.<span style="color:#8aadf4">Println</span>(<span style="color:#a6da95">&#34;Server started on :8080&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">68</span><span>	log.<span style="color:#8aadf4">Fatal</span>(http.<span style="color:#8aadf4">ListenAndServe</span>(<span style="color:#a6da95">&#34;:8080&#34;</span>, <span style="color:#f5a97f">nil</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#8087a2">69</span><span>}
</span></span></code></pre></div><p>The above rate limiter is now based on a global request counter rather than IP-based tracking, making it simpler for demonstration purposes.</p>
<hr>
<h2 id="future-improvements">
  Future improvements
  <a class="anchor" href="#future-improvements" aria-label="Link to section - Future improvements">#</a>
</h2>

<p>For future improvements, I plan to:</p>
<ul>
<li>Set up a circuit breaker – To prevent overwhelming backends that are failing or underperforming by temporarily stopping requests to them.</li>
<li>Explore different routing strategies, like weighted round robin or least connections, to optimize request distribution based on backend capacity.</li>
<li>Dynamically update the backend servers list – Automatically remove any failing servers from the list and add new ones without downtime.</li>
<li>Implement session persistence, ensuring that users consistently connect to the same backend during their session.</li>
<li>Cache requests to reduce load on backends and improve response times for repeated requests.</li>
</ul>
<p>See the <a href="https://github.com/krispingal/l7lb">github repository</a>.</p>
    </div>

    
    <footer class="article-footer">
        <nav class="article-tags">
  <ul class="tags" style="padding-left: 0px;padding-top:10px">
      <li><a href="/tags/golang/">Golang</a></li>
      <li><a href="/tags/load-balancer/">Load Balancer</a></li>
  </ul>

        </nav>
    </footer>
</article>
<aside class="related-posts">
<hr class="divider">
<h3 class="further-reading-heading">Continue Reading</h3>
<aside>
  <div class="related-cards">
    
      <a href="/articles/refining-load-balancer/" aria-label="Read more about Refining Load Balancer">
  <div class="related-card">
      <div class="card-category">System Design &amp; Architecture</div>
      <h3>Refining Load Balancer</h3>
      <p class="card-description">What lies beneath a scalable and efficient load balancer? Explore the transformative techniques that turn a basic implementation into a powerhouse of modularity and speed.</p>
  </div>
</a>
      <a href="/articles/from-jekyll-to-hugo/" aria-label="Read more about From Jekyll to Hugo">
  <div class="related-card">
      <div class="card-category">Programming Patterns &amp; Languages</div>
      <h3>From Jekyll to Hugo</h3>
      <p class="card-description">What makes a developer leave behind a well-loved tool for something new? Dive into the motivations, discoveries, and lessons learned in the shift from Jekyll to Hugo — and uncover the secrets to crafting a custom theme.</p>
  </div>
</a>
  </div>
</aside>
</aside>
<div class="content">
    <script src="https://giscus.app/client.js"
    data-repo="krispingal/krispingal.github.io"
    data-repo-id="R_kgDONNB2Ng"
    data-category="Announcements"
    data-category-id="DIC_kwDONNB2Ns4CmciE"
    data-mapping="url"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="catppuccin_latte"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
  </script>
</div>
  </main>
  <footer class="footer-nav">
<div class="footer-icons">
    <a href="/" aria-label="Home"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.743 12.331-9-10c-.379-.422-1.107-.422-1.486 0l-9 10a.998.998 0 0 0-.17 1.076c.16.361.518.593.913.593h2v7a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-4h4v4a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-7h2a.998.998 0 0 0 .743-1.669z"></path></svg></a>
    <a href="https://github.com/krispingal" target="_blank" aria-label="GitHub"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.026 2c-5.509 0-9.974 4.465-9.974 9.974 0 4.406 2.857 8.145 6.821 9.465.499.09.679-.217.679-.481 0-.237-.008-.865-.011-1.696-2.775.602-3.361-1.338-3.361-1.338-.452-1.152-1.107-1.459-1.107-1.459-.905-.619.069-.605.069-.605 1.002.07 1.527 1.028 1.527 1.028.89 1.524 2.336 1.084 2.902.829.091-.645.351-1.085.635-1.334-2.214-.251-4.542-1.107-4.542-4.93 0-1.087.389-1.979 1.024-2.675-.101-.253-.446-1.268.099-2.64 0 0 .837-.269 2.742 1.021a9.582 9.582 0 0 1 2.496-.336 9.554 9.554 0 0 1 2.496.336c1.906-1.291 2.742-1.021 2.742-1.021.545 1.372.203 2.387.099 2.64.64.696 1.024 1.587 1.024 2.675 0 3.833-2.33 4.675-4.552 4.922.355.308.675.916.675 1.846 0 1.334-.012 2.41-.012 2.737 0 .267.178.577.687.479C19.146 20.115 22 16.379 22 11.974 22 6.465 17.535 2 12.026 2z"></path></svg></a>
    <a href="https://linkedin.com/in/krishna-babuji" target="_blank" aria-label="LinkedIn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zM8.339 18.337H5.667v-8.59h2.672v8.59zM7.003 8.574a1.548 1.548 0 1 1 0-3.096 1.548 1.548 0 0 1 0 3.096zm11.335 9.763h-2.669V14.16c0-.996-.018-2.277-1.388-2.277-1.39 0-1.601 1.086-1.601 2.207v4.248h-2.667v-8.59h2.56v1.174h.037c.355-.675 1.227-1.387 2.524-1.387 2.704 0 3.203 1.778 3.203 4.092v4.71z"></path></svg></a>
    <a href="mailto:krishna.pingal@gmail.com" aria-label="Email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 4.7-8 5.334L4 8.7V6.297l8 5.333 8-5.333V8.7z"></path></svg></a>
    <a href="/articles/index.xml" aria-label="RSS"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon"><path d="M19 20.001C19 11.729 12.271 5 4 5v2c7.168 0 13 5.832 13 13.001h2z"></path><path d="M12 20.001h2C14 14.486 9.514 10 4 10v2c4.411 0 8 3.589 8 8.001z"></path><circle cx="6" cy="18" r="2"></circle></svg></a>
</div>
<p class="footer-copyright">© 2016 &ndash; 2025 kbabuji. All rights reserved.</p>

  </footer>
</body>

</html>